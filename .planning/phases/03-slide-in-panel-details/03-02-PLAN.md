---
phase: 03-slide-in-panel-details
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/components/panel/EmotionPanel.tsx
  - src/components/panel/SentimentPanel.tsx
  - src/components/panel/CulpabilitePanel.tsx
autonomous: true

must_haves:
  truths:
    - "EmotionPanel displays variations, triggers, defensive reactions, and needs"
    - "SentimentPanel displays variations, triggers, and satisfied needs"
    - "CulpabilitePanel shows 4 sub-cards in selection view"
    - "CulpabilitePanel shows detail view when sub-card selected"
    - "Back button in Culpabilite detail returns to selection (not close)"
  artifacts:
    - path: "src/components/panel/EmotionPanel.tsx"
      provides: "Panel content for standard emotions"
      exports: ["EmotionPanel"]
    - path: "src/components/panel/SentimentPanel.tsx"
      provides: "Panel content for pleasant sentiments"
      exports: ["SentimentPanel"]
    - path: "src/components/panel/CulpabilitePanel.tsx"
      provides: "Two-level panel for guilt emotion"
      exports: ["CulpabilitePanel"]
  key_links:
    - from: "src/components/panel/EmotionPanel.tsx"
      to: "SlidePanel"
      via: "wraps content in SlidePanel"
      pattern: "<SlidePanel"
    - from: "src/components/panel/CulpabilitePanel.tsx"
      to: "internal state"
      via: "view state (selection | detail)"
      pattern: "useState.*selection.*detail"
---

<objective>
Create the panel content components for emotions, sentiments, and the special Culpabilite two-level panel.

Purpose: Provide the actual content that displays inside SlidePanel when user taps an emotion or sentiment card.
Output: Three panel components ready to be integrated into emotion/sentiment pages.
</objective>

<execution_context>
@/root/.claude/get-shit-done/workflows/execute-plan.md
@/root/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-slide-in-panel-details/03-RESEARCH.md
@src/types/emotions.ts
@src/data/emotions.ts
@src/data/sentiments.ts
@src/components/panel/SlidePanel.tsx
@src/components/panel/PanelHeader.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create EmotionPanel for standard unpleasant emotions</name>
  <files>
    src/components/panel/EmotionPanel.tsx
  </files>
  <action>
Create `src/components/panel/EmotionPanel.tsx`:

Props interface:
```typescript
import type { Emotion } from '../../types/emotions';
import type { LucideIcon } from 'lucide-react';

interface EmotionPanelProps {
  emotion: Emotion;
  icon: LucideIcon;
  isOpen: boolean;
  onClose: () => void;
}
```

Implementation:

1. **Wrap in SlidePanel:**
   - Pass isOpen, onClose, and emotion.color as color prop
   - SlidePanel handles all the dialog/animation logic

2. **Header:**
   - Use PanelHeader with emotion.name as title
   - Pass emotion.color if needed for styling
   - onClose passed through

3. **Content sections** (inside a scrollable div with p-4 and space-y-6):

   a) **Icon and name hero:**
      - Icon at 48px with emotion color background
      - Name as decorative (already in header, skip duplicate)

   b) **Variations section:**
      - Label: "Variations" (text-sm font-medium text-text-secondary mb-2)
      - Display as flex wrap of pill badges
      - Each: `<span className="px-3 py-1 bg-white/10 rounded-full text-sm">`

   c) **Declencheurs (Triggers) section:**
      - Label: "Declencheurs"
      - Display as bullet list (ul with list-disc list-inside)
      - Each trigger as `<li>`

   d) **Reactions defensives section:**
      - Label: "Reactions defensives"
      - Same bullet list format

   e) **Besoins (Needs) section:**
      - Label: "Besoins"
      - Same bullet list format
      - Consider highlighting this section differently (it's the key insight)

4. **Styling considerations:**
   - Use emotion.textColor for text if needed (most emotions use white text)
   - Ensure sufficient contrast for readability
   - Section headers in text-text-secondary for hierarchy
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - Component imports SlidePanel and PanelHeader
    - All 4 content sections present (variations, triggers, reactions, needs)
  </verify>
  <done>
    - EmotionPanel renders emotion details in SlidePanel
    - All 4 content sections display correctly
    - Scrollable content area for long lists
  </done>
</task>

<task type="auto">
  <name>Task 2: Create SentimentPanel for pleasant emotions</name>
  <files>
    src/components/panel/SentimentPanel.tsx
  </files>
  <action>
Create `src/components/panel/SentimentPanel.tsx`:

Props interface:
```typescript
import type { Sentiment } from '../../types/emotions';
import type { LucideIcon } from 'lucide-react';

interface SentimentPanelProps {
  sentiment: Sentiment;
  icon: LucideIcon;
  isOpen: boolean;
  onClose: () => void;
}
```

Implementation:

1. **Wrap in SlidePanel:**
   - Same pattern as EmotionPanel
   - Pass sentiment.color

2. **Header:**
   - Use PanelHeader with sentiment.name

3. **Content sections** (p-4 space-y-6):

   a) **Variations section:**
      - Label: "Variations"
      - Pill badges format

   b) **Declencheurs (Triggers) section:**
      - Label: "Declencheurs"
      - Bullet list format

   c) **Besoins satisfaits section:**
      - Label: "Besoins satisfaits" (NOT "Besoins" - different from Emotion)
      - This is `sentiment.satisfiedNeeds` array
      - Bullet list format
      - Consider positive styling (this is good!)

Note: Sentiments do NOT have defensiveReactions - that's the structural difference from emotions. Only 3 sections instead of 4.
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - Component uses sentiment.satisfiedNeeds (not needs)
    - 3 sections present (variations, triggers, satisfied needs)
  </verify>
  <done>
    - SentimentPanel renders sentiment details in SlidePanel
    - Uses satisfiedNeeds instead of needs
    - No defensive reactions section (correct for sentiments)
  </done>
</task>

<task type="auto">
  <name>Task 3: Create CulpabilitePanel with two-level navigation</name>
  <files>
    src/components/panel/CulpabilitePanel.tsx
  </files>
  <action>
Create `src/components/panel/CulpabilitePanel.tsx`:

Props interface:
```typescript
import type { CulpabiliteEmotion, CulpabiliteSubType } from '../../types/emotions';
import type { LucideIcon } from 'lucide-react';

interface CulpabilitePanelProps {
  emotion: CulpabiliteEmotion;
  icon: LucideIcon;
  isOpen: boolean;
  onClose: () => void;
}
```

Implementation:

1. **Internal state:**
   ```typescript
   type CulpabiliteView = 'selection' | 'detail';
   const [view, setView] = useState<CulpabiliteView>('selection');
   const [selectedSubType, setSelectedSubType] = useState<CulpabiliteSubType | null>(null);
   ```

2. **Reset state when panel closes/opens:**
   - useEffect on isOpen: if !isOpen, reset to 'selection' and null

3. **Navigation handlers:**
   ```typescript
   const handleSubTypeSelect = (subType: CulpabiliteSubType) => {
     setSelectedSubType(subType);
     setView('detail');
   };

   const handleBack = () => {
     setView('selection');
     setSelectedSubType(null);
   };
   ```

4. **Selection view (view === 'selection'):**
   - PanelHeader: title="Culpabilite", onClose, NO onBack
   - Intro text: "La culpabilite peut prendre 4 formes differentes"
   - 2x2 grid of sub-type cards:
     ```tsx
     <div className="grid grid-cols-2 gap-4 p-4">
       {emotion.subTypes.map((subType) => (
         <button
           key={subType.id}
           onClick={() => handleSubTypeSelect(subType)}
           className="p-4 bg-taupe/20 rounded-xl text-left hover:bg-taupe/30
                      focus:outline-none focus:ring-2 focus:ring-taupe"
         >
           <h3 className="font-semibold mb-1">{subType.name}</h3>
           <p className="text-sm text-text-secondary">
             {subType.keywords.join(' · ')}
           </p>
         </button>
       ))}
     </div>
     ```

5. **Detail view (view === 'detail'):**
   - PanelHeader: title=selectedSubType.name, onClose, onBack=handleBack
   - Same content layout as EmotionPanel:
     - Variations (pills)
     - Declencheurs (bullets)
     - Reactions defensives (bullets)
     - Besoins (bullets)

6. **Wrap everything in single SlidePanel:**
   - isOpen, onClose, color=emotion.color
   - Content switches between selection and detail views inside

Critical: This is ONE panel with internal navigation, NOT two nested panels. The PanelHeader changes based on view state.
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - useState for view and selectedSubType present
    - handleBack function returns to selection view
    - PanelHeader has onBack only in detail view
    - 4 sub-type buttons rendered in selection view
  </verify>
  <done>
    - CulpabilitePanel shows 4 sub-type selection cards
    - Tapping sub-type shows detail view with back button
    - Back button returns to selection (not closes panel)
    - State resets when panel closes
  </done>
</task>

</tasks>

<verification>
After all tasks:

1. **Build check:**
   ```bash
   npm run build
   ```
   Should complete without errors.

2. **Type check:**
   ```bash
   npx tsc --noEmit
   ```
   No type errors.

3. **File structure:**
   ```
   src/components/panel/
   ├── SlidePanel.tsx      (from 03-01)
   ├── PanelHeader.tsx     (from 03-01)
   ├── EmotionPanel.tsx    (new)
   ├── SentimentPanel.tsx  (new)
   └── CulpabilitePanel.tsx (new)
   ```

4. **Import verification:**
   - All panels import SlidePanel and PanelHeader
   - EmotionPanel imports Emotion type
   - SentimentPanel imports Sentiment type
   - CulpabilitePanel imports CulpabiliteEmotion and CulpabiliteSubType types
</verification>

<success_criteria>
- EmotionPanel displays all 4 sections for standard emotions
- SentimentPanel displays 3 sections (no defensive reactions)
- CulpabilitePanel shows 2x2 grid of sub-types in selection view
- CulpabilitePanel shows detail content when sub-type selected
- Back button in detail view returns to selection (panel stays open)
- All panels use SlidePanel wrapper correctly
- All components type-check without errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-slide-in-panel-details/03-02-SUMMARY.md`
</output>
