---
phase: 04-steps-carousel-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/steps.ts
  - src/data/steps.ts
  - src/components/steps/StepCard.tsx
  - src/components/steps/ProgressIndicator.tsx
  - src/components/steps/StepsCarousel.tsx
autonomous: true

must_haves:
  truths:
    - "Step type captures id, title, question, and actions array"
    - "All 5 steps data extracted verbatim from content source"
    - "StepCard renders step number badge, title, question, and action bullets"
    - "ProgressIndicator shows dots and numeric counter (e.g., 2/5)"
    - "StepsCarousel handles swipe left/right and arrow key navigation"
  artifacts:
    - path: "src/types/steps.ts"
      provides: "Step interface definition"
      exports: ["Step"]
    - path: "src/data/steps.ts"
      provides: "5 steps data array"
      exports: ["steps"]
    - path: "src/components/steps/StepCard.tsx"
      provides: "Individual step card display"
      exports: ["StepCard"]
    - path: "src/components/steps/ProgressIndicator.tsx"
      provides: "Dot indicators + numeric counter"
      exports: ["ProgressIndicator"]
    - path: "src/components/steps/StepsCarousel.tsx"
      provides: "Carousel container with swipe + keyboard navigation"
      exports: ["StepsCarousel"]
  key_links:
    - from: "src/data/steps.ts"
      to: "src/types/steps.ts"
      via: "import Step type"
      pattern: "import.*Step.*from.*types/steps"
    - from: "src/components/steps/StepsCarousel.tsx"
      to: "react-swipeable"
      via: "useSwipeable hook"
      pattern: "useSwipeable"
    - from: "src/components/steps/StepsCarousel.tsx"
      to: "src/hooks/usePrefersReducedMotion"
      via: "motion preference check"
      pattern: "usePrefersReducedMotion"
---

<objective>
Build the data layer and carousel components for the 5-step emotional regulation process.

Purpose: Create the foundational pieces needed to display one step at a time with horizontal navigation.
Output: Step type, 5 steps data, StepCard, ProgressIndicator, StepsCarousel components.
</objective>

<execution_context>
@/root/.claude/get-shit-done/workflows/execute-plan.md
@/root/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-steps-carousel---polish/04-RESEARCH.md

@tableaux-regulation-emotionnelle-complet.md (content source - steps verbatim)
@src/types/emotions.ts (pattern reference)
@src/hooks/usePrefersReducedMotion.ts (existing hook to reuse)
@src/index.css (design tokens)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Step type and data layer</name>
  <files>src/types/steps.ts, src/data/steps.ts</files>
  <action>
Create Step interface in src/types/steps.ts:
```typescript
export interface Step {
  id: number;         // 1-5
  title: string;      // e.g., "S'arreter"
  question: string;   // Key question with proper French accents
  actions: string[];  // Bullet points from content
}
```

Create src/data/steps.ts with all 5 steps from tableaux-regulation-emotionnelle-complet.md:
1. S'arreter - "C'est plus fort que moi, je vois bien que je reagis." (5 actions)
2. S'observer et identifier les emotions - "Qu'est-ce qui se passe pour moi?" (4 actions)
3. Accueillir les emotions et les ressentir - "Qu'est-ce que je vis en ce moment?" (4 actions)
4. Identifier ses besoins et se responsabiliser - "Qu'est-ce qui me ferait du bien par rapport a la situation?" (4 actions)
5. Passer a l'action - "Qu'est-ce qui est en mon pouvoir pour prendre soin de moi?" (5 actions)

Use proper French accents (e, e, a, etc.) as in the source content. Export as `export const steps: Step[]`.
  </action>
  <verify>
TypeScript compiles: `npx tsc --noEmit`
steps.length === 5
Each step has id, title, question, and actions array
  </verify>
  <done>Step type defined and all 5 steps data populated with verbatim content</done>
</task>

<task type="auto">
  <name>Task 2: Carousel components</name>
  <files>src/components/steps/StepCard.tsx, src/components/steps/ProgressIndicator.tsx, src/components/steps/StepsCarousel.tsx</files>
  <action>
Create src/components/steps/ directory with three components:

**StepCard.tsx:**
- Props: step (Step), stepNumber (number), totalSteps (number)
- Render: bg-bg-secondary rounded-2xl card with:
  - Step number badge (bg-brand-primary circle with white text)
  - Title next to badge (text-xl font-semibold)
  - Question in italics (text-brand-link)
  - Action bullets with brand-primary bullet markers
- Use min-h-[400px] to ensure consistent height
- Add mx-4 for horizontal margin (carousel will handle overflow)

**ProgressIndicator.tsx:**
- Props: current (0-indexed), total (number), onGoTo (index => void)
- Render: flex container with:
  - Dot buttons (w-3 h-3 rounded-full, bg-brand-primary when current, bg-white/30 otherwise)
  - Numeric counter span (text-text-secondary, "1/5" format)
- Add aria-label on dots, aria-disabled on current dot
- Add aria-live="polite" on counter span

**StepsCarousel.tsx:**
- Import useReducer from React, useSwipeable from react-swipeable
- Import usePrefersReducedMotion from hooks
- Import steps from data, StepCard, ProgressIndicator
- Implement carouselReducer with state: {pos, sliding, dir}
  - PREV: decrease pos (stop at 0, no wrap)
  - NEXT: increase pos (stop at numItems-1, no wrap)
  - GO_TO: jump to specific pos
  - STOP_SLIDING: set sliding to false
- Configure useSwipeable:
  - onSwipedLeft: slide NEXT (if not at end)
  - onSwipedRight: slide PREV (if not at start)
  - delta: 50, preventScrollOnSwipe: true, trackTouch: true, trackMouse: false
- Render:
  - Header with title "Les 5 etapes" and subtitle
  - Navigation arrows (ChevronLeft/ChevronRight from lucide-react) in flex justify-between
  - Carousel container with overflow-hidden, role="region", aria-roledescription="carousel"
  - Inner flex container with translateX(-pos*100%) transform
  - Conditional transition-transform duration-300 (skip if prefersReducedMotion)
  - Each step in w-full flex-shrink-0 wrapper with role="group", aria-roledescription="slide"
  - tabIndex={0} on carousel for keyboard focus
  - onKeyDown: ArrowLeft/ArrowRight to navigate
  - ProgressIndicator below carousel

After slide(), use setTimeout(300ms) to dispatch STOP_SLIDING (skip timeout if prefersReducedMotion).
  </action>
  <verify>
Components exist and TypeScript compiles: `npx tsc --noEmit`
StepsCarousel imports and uses react-swipeable
StepsCarousel imports and uses usePrefersReducedMotion
  </verify>
  <done>StepCard, ProgressIndicator, and StepsCarousel components created with swipe, arrow, and keyboard navigation</done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes with no errors
- All 5 files created in correct locations
- Steps data matches content source verbatim
- Carousel uses react-swipeable for horizontal swipe detection
- Carousel respects reduced motion preference
- ARIA attributes present for accessibility
</verification>

<success_criteria>
1. Step type exported from src/types/steps.ts
2. 5 steps data exported from src/data/steps.ts
3. StepCard renders single step with badge, title, question, actions
4. ProgressIndicator renders dots + counter with accessibility
5. StepsCarousel handles swipe, arrows, and keyboard navigation
6. All TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/04-steps-carousel---polish/04-01-SUMMARY.md`
</output>
